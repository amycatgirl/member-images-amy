#!/usr/bin/env bash

# Mazurek post install script. Will attempt to do a few things after boot
# and will attempt to disable the service (itself) when done.

set -euo pipefail

# Make a file to prevent this user from running twice.
# If file is found, script exits gracefully

if [ -f /etc/.mazurek-post ]; then
    /bin/echo 'Script has already been ran before. Aborting...'
    return 1
fi

# create proper sddm groups and users, required
# as it's currently impossible to do this within
# image creation.
groupadd -g 973 adbusers # no idea if this one is required, but we'll see
groupadd -g 972 sddm
useradd -u 972 -g 972 sddm

# create file when done to prevent users who have
# already ran the script but encountered issues in
# between to re-run
if [ -f /etc/.mazurek-post ]; then
    /bin/touch '/etc/.mazurek-post'
fi

# done with everything, now we'll disable ourselves.
/bin/systemctl disable system-mazurek.service
