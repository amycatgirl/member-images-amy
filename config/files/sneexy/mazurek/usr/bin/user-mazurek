#!/usr/bin/env bash

# Mazurek post install script for users. Will attempt to copy
# configurations to user dirs and also set some things.

set -euo pipefail

# Make a file to prevent this user from running twice.
# If file is found, script exits gracefully

if [ -f ${XDG_CONFIG_HOME}/.mazurek-post-user ]; then
    /bin/echo 'Script has already been ran before. Aborting...'
    return 1
fi

# copy files over to their respective location on the users side
mkdir -p '${XDG_CONFIG_HOME}/sway'
mkdir -p '${XDG_CONFIG_HOME}/waybar'
cp '/etc/sway/config' '${XDG_CONFIG_HOME}/sway/config'
cp '/etc/xdg/waybar/config' '${XDG_CONFIG_HOME}/waybar/config'
cp '/etc/xdg/waybar/style.css' '${XDG_CONFIG_HOME}/waybar/style.css'

# update user dirs
xdg-user-dirs-update

# create file when done to prevent users who have
# already ran the script but encountered issues in
# between to re-run
if [ -f ${XDG_CONFIG_HOME}/.mazurek-post-user ]; then
    /bin/touch '${XDG_CONFIG_HOME}/.mazurek-post-user'
fi

# done with everything, now we'll disable ourselves.
/bin/systemctl disable system-mazurek.service
